// Generated by Celest. This file should not be modified manually, but
// it can be checked into version control.
// ignore_for_file: type=lint, unused_local_variable, unnecessary_cast, unnecessary_import

library; // ignore_for_file: no_leading_underscores_for_library_prefixes

import 'package:_common/src/models/available_stock.dart' as _$available_stock;
import 'package:celest/celest.dart';
import 'package:celest_core/src/exception/cloud_exception.dart';
import 'package:celest_core/src/exception/serialization_exception.dart';
import 'package:celest_core/src/serialization/json_value.dart';

import '../../client.dart';

class CelestFunctions {
  /// Tests the ability to use server-side streaming.
  final serverSide = CelestFunctionsServerSide();
}

/// Tests the ability to use server-side streaming.
class CelestFunctionsServerSide {
  Never _throwError({
    required int $statusCode,
    required Map<String, Object?> $body,
  }) {
    final $error = ($body['error'] as Map<String, Object?>);
    final $code = ($error['code'] as String);
    final $details = ($error['details'] as Map<String, Object?>?);
    switch ($code) {
      case r'BadRequestException':
        throw Serializers.instance.deserialize<BadRequestException>($details);
      case r'UnauthorizedException':
        throw Serializers.instance.deserialize<UnauthorizedException>($details);
      case r'InternalServerError':
        throw Serializers.instance.deserialize<InternalServerError>($details);
      case r'SerializationException':
        throw Serializers.instance
            .deserialize<SerializationException>($details);
      case _:
        switch ($statusCode) {
          case 400:
            throw BadRequestException($code);
          case _:
            throw InternalServerError($code);
        }
    }
  }

  Stream<String> hello(List<String> names) {
    final $channel = celest.eventClient
        .connect(celest.baseUri.resolve('/server-side/hello'));
    $channel.sink.add({r'names': names});
    return $channel.stream.map(($event) {
      if ($event.containsKey('error')) {
        _throwError($statusCode: -1, $body: $event);
      }
      return ($event['response'] as String);
    });
  }

  Stream<_$available_stock.AvailableStock> stockTicker(String symbol) {
    final $channel = celest.eventClient.connect(celest.baseUri
        .resolve('/server-side/stock-ticker')
        .replace(queryParameters: {r'symbol': symbol}));
    return $channel.stream.map(($event) {
      if ($event.containsKey('error')) {
        _throwError($statusCode: -1, $body: $event);
      }
      return Serializers.instance
          .deserialize<_$available_stock.AvailableStock>($event['response']);
    });
  }

  Stream<JsonValue> jsonValues() {
    final $channel = celest.eventClient
        .connect(celest.baseUri.resolve('/server-side/json-values'));
    return $channel.stream.map(($event) {
      if ($event.containsKey('error')) {
        _throwError($statusCode: -1, $body: $event);
      }
      return Serializers.instance.deserialize<JsonValue>(
        $event['response'],
        const TypeToken<JsonValue>('JsonValue'),
      );
    });
  }
}
